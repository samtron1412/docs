<!DOCTYPE html>
<!-- saved from url=(0083)https://docs.google.com/document/d/1GCK53YDcBWQveod9kfzW-VCxIABGiryG7_z_6jHdVik/pub -->
<html class="gr__docs_google_com"><script data-x-lastpass="">(function(){var c=0;if("undefined"!==typeof CustomEvent&&"function"===typeof window.dispatchEvent){var a=function(a){try{if("object"===typeof a&&(a=JSON.stringify(a)),"string"===typeof a)return window.dispatchEvent(new CustomEvent("lprequeststart",{detail:{data:a,requestID:++c}})),c}catch(f){}},b=function(a){try{window.dispatchEvent(new CustomEvent("lprequestend",{detail:a}))}catch(f){}};"undefined"!==typeof XMLHttpRequest&&XMLHttpRequest.prototype&&XMLHttpRequest.prototype.send&&(XMLHttpRequest.prototype.send=
function(c){return function(f){var d=this,e=a(f);e&&d.addEventListener("loadend",function(){b({requestID:e,statusCode:d.status})});return c.apply(d,arguments)}}(XMLHttpRequest.prototype.send));"function"===typeof fetch&&(fetch=function(c){return function(f,d){var e=a(d),g=c.apply(this,arguments);if(e){var h=function(a){b({requestID:e,statusCode:a&&a.status})};g.then(h)["catch"](h)}return g}}(fetch))}})();
(function(){if("undefined"!==typeof CustomEvent){var c=function(a){if(a.lpsubmit)return a;var b=function(){try{this.dispatchEvent(new CustomEvent("lpsubmit"))}catch(k){}return a.apply(this,arguments)};b.lpsubmit=!0;return b};window.addEventListener("DOMContentLoaded",function(){if(document&&document.forms&&0<document.forms.length)for(var a=0;a<document.forms.length;++a)document.forms[a].submit=c(document.forms[a].submit)},!0);document.createElement=function(a){return function(){var b=a.apply(this,
arguments);b&&"FORM"===b.nodeName&&b.submit&&(b.submit=c(b.submit));return b}}(document.createElement)}})();
</script><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script type="text/javascript">(function(){(function(){function e(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp("CSI/"+a)}catch(h){}};this.tick("start",null,a)}var a,d;window.performance&&(d=(a=window.performance.timing)&&a.responseStart);var f=0<d?new e(d):new e;window.jstiming={Timer:e,load:f};if(a){var c=a.navigationStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick("_wtsrt",void 0,c),b.tick("wtsrt_","_wtsrt",d),
b.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick("_tbnd",void 0,window.chrome.csi().startE),b.tick("tbnd_","_tbnd",c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick("_tbnd",void 0,window.external.startE),b.tick("tbnd_","_tbnd",c))),a&&(window.jstiming.pt=a)}catch(g){}})();}).call(this);
</script><script type="text/javascript">var KX_timer = new window.jstiming.Timer(); KX_timer.name = 'published';</script><title>GitLab.com Database Incident - 2017/01/31</title><link rel="shortcut icon" href="https://ssl.gstatic.com/docs/documents/images/kix-favicon6.ico"><style type="text/css">
      body {
        font-family: arial, sans, sans-serif;
        margin: 0;
      }

      iframe {
        border: 0;
        frameborder: 0;
        height: 100%;
        width: 100%;
      }

      #header, #footer {
        background: #f0f0f0;
        padding: 10px 10px;
      }

      #header {
        border-bottom: 1px #ccc solid;
      }

      #footer {
        border-top: 1px #ccc solid;
        border-bottom: 1px #ccc solid;
        font-size: 13;
      }

      #contents {
        margin: 6px;
      }

      .dash {
        padding: 0 6px;
      }
    </style><style type="text/css">
:root div[style^="height: 16px; font: bold 12px/16px"],
:root [style="border: 1px solid rgb(51, 102, 204);"],
:root [style="border: 1px solid rgb(51, 102, 153);"],
:root [style="border: 1px solid rgb(241, 250, 248);"],
:root [style="border: 1px solid rgb(145, 117, 77);"],
:root [style="border: 1px solid rgb(0, 90, 136);"],
:root .ts[style="margin:0 0 12px;height:92px;width:100%"],
:root .nH.MC,
:root .c[style="margin: 0pt;"],
:root .GISRH3UDHB,
:root .GGQPGYLCMCB,
:root .GGQPGYLCD5,
:root .GC3LC41DERB + div[style="position: relative; height: 170px;"],
:root #tadsc,
:root #ad,
:root #sqh,
:root .widget-pane-section-result[data-result-ad-type],
:root .rscontainer > .ellip,
:root .rhsvw[style="background-color:#fff;margin:0 0 14px;padding-bottom:1px;padding-top:1px;"],
:root .ra[width="30%"][align="right"] + table[width="70%"][cellpadding="0"],
:root .ra[align="right"][width="30%"],
:root .ra[align="left"][width="30%"],
:root .mw > #rcnt > #center_col > #taw > .c,
:root .mw > #rcnt > #center_col > #taw > #tvcap > .c,
:root .mod > ._jH + .rscontainer,
:root .lads[width="100%"][style="background:#FFF8DD"],
:root .commercial-unit-mobile-top,
:root .commercial-unit-desktop-top,
:root .commercial-unit-desktop-rhs,
:root .ch[onclick="ga(this,event)"],
:root .GPMV2XEDA2 > .GPMV2XEDP1 > .GPMV2XEDJBB,
:root .GKJYXHBF2 > .GKJYXHBE2 > .GKJYXHBH5,
:root .GJJKPX2N1 > .GJJKPX2M1 > .GJJKPX2P4,
:root .GHOFUQ5BG2 > .GHOFUQ5BF2 > .GHOFUQ5BG5,
:root .GFYY1SVE2 > .GFYY1SVD2 > .GFYY1SVG5,
:root .GFYY1SVD2 > .GFYY1SVC2 > .GFYY1SVF5,
:root .GB3L-QEDGY .GB3L-QEDF- > .GB3L-QEDE-,
:root #topstuff > #tads,
:root #tadsto.c,
:root #tadsb.c,
:root #tads.c,
:root #tads + div + .c,
:root #ssmiwdiv[jsdisplay],
:root #rhswrapper > #rhssection[border="0"][bgcolor="#ffffff"],
:root #rhs_block > script + .c._oc._Ve.rhsvw,
:root #rhs_block > ol > .rhsvw > .kp-blk > .xpdopen > ._OKe > ol > ._DJe > .luhb-div,
:root #rhs_block > .ts[cellspacing="0"][cellpadding="0"][style="padding:0"],
:root #rhs_block > #mbEnd,
:root #rhs_block .mod > .luhb-div > div[data-async-type="updateHotelBookingModule"],
:root #rhs_block .mod > .gws-local-hotels__booking-module,
:root #resultspanel > #topads,
:root #mn div[style="position:relative"] > #center_col > div > ._dPg,
:root #mn div[style="position:relative"] > #center_col > ._Ak,
:root #mn #center_col > div > h2.spon:first-child + ol:last-child,
:root #mn #center_col > div > h2.spon:first-child,
:root #mclip_container:last-child,
:root #mbEnd[cellspacing="0"][cellpadding="0"],
:root #main_col > #center_col div[style="font-size:14px;margin:0 4px;padding:1px 5px;background:#fff7ed"],
:root #cnt #center_col > #taw > #tvcap > .c._oc._Lp,
:root #cnt #center_col > #res > #topstuff > .ts,
:root #center_col > div[style="font-size:14px;margin-right:0;min-height:5px"] > div[style="font-size:14px;margin:0 4px;padding:1px 5px;background:#fff8e7"],
:root #center_col > #taw > #tvcap > .rscontainer,
:root #center_col > #resultStats + div[style="border:1px solid #dedede;margin-bottom:11px;padding:5px 7px 5px 6px"],
:root #center_col > #resultStats + div + #res + #tads,
:root #center_col > #resultStats + #tads + #res + #tads,
:root #center_col > #resultStats + #tads,
:root #center_col > #res > #topstuff + #search > div > #ires > #rso > #flun,
:root #center_col > #main > .dfrd > .mnr-c > .c._oc._zs,
:root #center_col > #\5f Emc
{ display: none !important; }</style><style type="text/css">
:root #header + #content > #left > #rlblock_left
{ display: none !important; }</style></head><body data-gr-c-s-loaded="true"><div id="header">GitLab.com Database Incident - 2017/01/31</div><div id="contents"><style type="text/css">@import url('https://themes.googleusercontent.com/fonts/css?kit=lhDjYqiy3mZ0x6ROQEUoUw');.lst-kix_q1mwnxtilbdj-6>li:before{content:"" counter(lst-ctn-kix_q1mwnxtilbdj-6,decimal) ". "}.lst-kix_q1mwnxtilbdj-5>li:before{content:"" counter(lst-ctn-kix_q1mwnxtilbdj-5,lower-roman) ". "}.lst-kix_q1mwnxtilbdj-7>li:before{content:"" counter(lst-ctn-kix_q1mwnxtilbdj-7,lower-latin) ". "}ol.lst-kix_q1mwnxtilbdj-0.start{counter-reset:lst-ctn-kix_q1mwnxtilbdj-0 0}.lst-kix_q1mwnxtilbdj-3>li:before{content:"" counter(lst-ctn-kix_q1mwnxtilbdj-3,decimal) ". "}.lst-kix_q1mwnxtilbdj-4>li:before{content:"" counter(lst-ctn-kix_q1mwnxtilbdj-4,lower-latin) ". "}.lst-kix_sqabk8o3z8od-1>li{counter-increment:lst-ctn-kix_sqabk8o3z8od-1}.lst-kix_43rb37omyu3r-3>li:before{content:"\0025cf  "}.lst-kix_43rb37omyu3r-2>li:before{content:"\0025a0  "}.lst-kix_q1mwnxtilbdj-2>li:before{content:"" counter(lst-ctn-kix_q1mwnxtilbdj-2,lower-roman) ". "}.lst-kix_q1mwnxtilbdj-1>li:before{content:"" counter(lst-ctn-kix_q1mwnxtilbdj-1,lower-latin) ". "}.lst-kix_43rb37omyu3r-1>li:before{content:"\0025cb  "}.lst-kix_q1mwnxtilbdj-0>li:before{content:"" counter(lst-ctn-kix_q1mwnxtilbdj-0,decimal) ". "}.lst-kix_jii9o7uqpkrd-2>li{counter-increment:lst-ctn-kix_jii9o7uqpkrd-2}.lst-kix_43rb37omyu3r-0>li:before{content:"\0025cf  "}ol.lst-kix_ucchapg7uvfq-7.start{counter-reset:lst-ctn-kix_ucchapg7uvfq-7 0}.lst-kix_q1mwnxtilbdj-8>li{counter-increment:lst-ctn-kix_q1mwnxtilbdj-8}.lst-kix_43rb37omyu3r-4>li:before{content:"\0025cb  "}ol.lst-kix_jii9o7uqpkrd-2.start{counter-reset:lst-ctn-kix_jii9o7uqpkrd-2 0}.lst-kix_43rb37omyu3r-5>li:before{content:"\0025a0  "}ol.lst-kix_jii9o7uqpkrd-8.start{counter-reset:lst-ctn-kix_jii9o7uqpkrd-8 0}.lst-kix_43rb37omyu3r-6>li:before{content:"\0025cf  "}ol.lst-kix_sqabk8o3z8od-1.start{counter-reset:lst-ctn-kix_sqabk8o3z8od-1 0}.lst-kix_43rb37omyu3r-7>li:before{content:"\0025cb  "}.lst-kix_43rb37omyu3r-8>li:before{content:"\0025a0  "}ol.lst-kix_q1mwnxtilbdj-5.start{counter-reset:lst-ctn-kix_q1mwnxtilbdj-5 0}.lst-kix_jii9o7uqpkrd-4>li{counter-increment:lst-ctn-kix_jii9o7uqpkrd-4}.lst-kix_sqabk8o3z8od-0>li:before{content:"" counter(lst-ctn-kix_sqabk8o3z8od-0,decimal) ". "}.lst-kix_q1mwnxtilbdj-6>li{counter-increment:lst-ctn-kix_q1mwnxtilbdj-6}.lst-kix_sqabk8o3z8od-8>li{counter-increment:lst-ctn-kix_sqabk8o3z8od-8}ol.lst-kix_ucchapg7uvfq-1.start{counter-reset:lst-ctn-kix_ucchapg7uvfq-1 0}.lst-kix_ucchapg7uvfq-0>li{counter-increment:lst-ctn-kix_ucchapg7uvfq-0}ol.lst-kix_q1mwnxtilbdj-6.start{counter-reset:lst-ctn-kix_q1mwnxtilbdj-6 0}.lst-kix_sqabk8o3z8od-6>li:before{content:"" counter(lst-ctn-kix_sqabk8o3z8od-6,decimal) ". "}.lst-kix_sqabk8o3z8od-5>li{counter-increment:lst-ctn-kix_sqabk8o3z8od-5}.lst-kix_sqabk8o3z8od-8>li:before{content:"" counter(lst-ctn-kix_sqabk8o3z8od-8,lower-roman) ". "}.lst-kix_sqabk8o3z8od-7>li:before{content:"" counter(lst-ctn-kix_sqabk8o3z8od-7,lower-latin) ". "}.lst-kix_sqabk8o3z8od-2>li:before{content:"" counter(lst-ctn-kix_sqabk8o3z8od-2,lower-roman) ". "}.lst-kix_sqabk8o3z8od-3>li:before{content:"" counter(lst-ctn-kix_sqabk8o3z8od-3,decimal) ". "}ol.lst-kix_jii9o7uqpkrd-3.start{counter-reset:lst-ctn-kix_jii9o7uqpkrd-3 0}ol.lst-kix_ucchapg7uvfq-8.start{counter-reset:lst-ctn-kix_ucchapg7uvfq-8 0}.lst-kix_sqabk8o3z8od-1>li:before{content:"" counter(lst-ctn-kix_sqabk8o3z8od-1,lower-latin) ". "}.lst-kix_sqabk8o3z8od-5>li:before{content:"" counter(lst-ctn-kix_sqabk8o3z8od-5,lower-roman) ". "}ol.lst-kix_ucchapg7uvfq-2.start{counter-reset:lst-ctn-kix_ucchapg7uvfq-2 0}.lst-kix_sqabk8o3z8od-4>li:before{content:"" counter(lst-ctn-kix_sqabk8o3z8od-4,lower-latin) ". "}.lst-kix_q1mwnxtilbdj-4>li{counter-increment:lst-ctn-kix_q1mwnxtilbdj-4}ul.lst-kix_9ffndsr7zdrj-6{list-style-type:none}ul.lst-kix_9ffndsr7zdrj-7{list-style-type:none}ul.lst-kix_9ffndsr7zdrj-8{list-style-type:none}.lst-kix_9ffndsr7zdrj-4>li:before{content:"\0025cb  "}.lst-kix_jii9o7uqpkrd-8>li{counter-increment:lst-ctn-kix_jii9o7uqpkrd-8}ul.lst-kix_9ffndsr7zdrj-2{list-style-type:none}ul.lst-kix_9ffndsr7zdrj-3{list-style-type:none}ul.lst-kix_9ffndsr7zdrj-4{list-style-type:none}ul.lst-kix_9ffndsr7zdrj-5{list-style-type:none}ol.lst-kix_sqabk8o3z8od-2.start{counter-reset:lst-ctn-kix_sqabk8o3z8od-2 0}ul.lst-kix_9ffndsr7zdrj-0{list-style-type:none}.lst-kix_9ffndsr7zdrj-2>li:before{content:"\0025a0  "}ul.lst-kix_9ffndsr7zdrj-1{list-style-type:none}ol.lst-kix_ucchapg7uvfq-0.start{counter-reset:lst-ctn-kix_ucchapg7uvfq-0 0}.lst-kix_9ffndsr7zdrj-0>li:before{content:"\0025cf  "}.lst-kix_q1mwnxtilbdj-5>li{counter-increment:lst-ctn-kix_q1mwnxtilbdj-5}.lst-kix_jii9o7uqpkrd-1>li:before{content:"" counter(lst-ctn-kix_jii9o7uqpkrd-1,lower-latin) ". "}ol.lst-kix_q1mwnxtilbdj-1.start{counter-reset:lst-ctn-kix_q1mwnxtilbdj-1 0}.lst-kix_q1mwnxtilbdj-3>li{counter-increment:lst-ctn-kix_q1mwnxtilbdj-3}ol.lst-kix_ucchapg7uvfq-5{list-style-type:none}ol.lst-kix_ucchapg7uvfq-6{list-style-type:none}ol.lst-kix_ucchapg7uvfq-7{list-style-type:none}ol.lst-kix_ucchapg7uvfq-8{list-style-type:none}ol.lst-kix_ucchapg7uvfq-1{list-style-type:none}ol.lst-kix_ucchapg7uvfq-2{list-style-type:none}ol.lst-kix_ucchapg7uvfq-3{list-style-type:none}.lst-kix_ucchapg7uvfq-2>li{counter-increment:lst-ctn-kix_ucchapg7uvfq-2}ol.lst-kix_ucchapg7uvfq-4{list-style-type:none}ol.lst-kix_q1mwnxtilbdj-4.start{counter-reset:lst-ctn-kix_q1mwnxtilbdj-4 0}ol.lst-kix_ucchapg7uvfq-0{list-style-type:none}.lst-kix_sqabk8o3z8od-3>li{counter-increment:lst-ctn-kix_sqabk8o3z8od-3}.lst-kix_1gwoiqua32b8-6>li:before{content:"\0025cf  "}.lst-kix_1gwoiqua32b8-4>li:before{content:"\0025cb  "}.lst-kix_jii9o7uqpkrd-3>li:before{content:"" counter(lst-ctn-kix_jii9o7uqpkrd-3,decimal) ". "}ol.lst-kix_sqabk8o3z8od-0.start{counter-reset:lst-ctn-kix_sqabk8o3z8od-0 0}.lst-kix_sqabk8o3z8od-4>li{counter-increment:lst-ctn-kix_sqabk8o3z8od-4}ol.lst-kix_jii9o7uqpkrd-1.start{counter-reset:lst-ctn-kix_jii9o7uqpkrd-1 0}.lst-kix_jii9o7uqpkrd-7>li:before{content:"" counter(lst-ctn-kix_jii9o7uqpkrd-7,lower-latin) ". "}.lst-kix_jii9o7uqpkrd-5>li:before{content:"" counter(lst-ctn-kix_jii9o7uqpkrd-5,lower-roman) ". "}.lst-kix_1gwoiqua32b8-8>li:before{content:"\0025a0  "}.lst-kix_ucchapg7uvfq-1>li{counter-increment:lst-ctn-kix_ucchapg7uvfq-1}ol.lst-kix_jii9o7uqpkrd-0.start{counter-reset:lst-ctn-kix_jii9o7uqpkrd-0 0}.lst-kix_ucchapg7uvfq-7>li{counter-increment:lst-ctn-kix_ucchapg7uvfq-7}.lst-kix_jii9o7uqpkrd-3>li{counter-increment:lst-ctn-kix_jii9o7uqpkrd-3}.lst-kix_9ffndsr7zdrj-6>li:before{content:"\0025cf  "}.lst-kix_9ffndsr7zdrj-8>li:before{content:"\0025a0  "}ol.lst-kix_q1mwnxtilbdj-2.start{counter-reset:lst-ctn-kix_q1mwnxtilbdj-2 0}ol.lst-kix_jii9o7uqpkrd-6{list-style-type:none}ol.lst-kix_jii9o7uqpkrd-5{list-style-type:none}ol.lst-kix_jii9o7uqpkrd-4{list-style-type:none}ol.lst-kix_jii9o7uqpkrd-3{list-style-type:none}ol.lst-kix_jii9o7uqpkrd-2{list-style-type:none}.lst-kix_q1mwnxtilbdj-8>li:before{content:"" counter(lst-ctn-kix_q1mwnxtilbdj-8,lower-roman) ". "}ol.lst-kix_jii9o7uqpkrd-1{list-style-type:none}ol.lst-kix_jii9o7uqpkrd-0{list-style-type:none}.lst-kix_sqabk8o3z8od-0>li{counter-increment:lst-ctn-kix_sqabk8o3z8od-0}ol.lst-kix_jii9o7uqpkrd-8{list-style-type:none}ol.lst-kix_jii9o7uqpkrd-7{list-style-type:none}.lst-kix_jii9o7uqpkrd-1>li{counter-increment:lst-ctn-kix_jii9o7uqpkrd-1}.lst-kix_ucchapg7uvfq-0>li:before{content:"" counter(lst-ctn-kix_ucchapg7uvfq-0,decimal) ". "}ol.lst-kix_q1mwnxtilbdj-3.start{counter-reset:lst-ctn-kix_q1mwnxtilbdj-3 0}ol.lst-kix_sqabk8o3z8od-1{list-style-type:none}ol.lst-kix_sqabk8o3z8od-0{list-style-type:none}ol.lst-kix_sqabk8o3z8od-3{list-style-type:none}ol.lst-kix_sqabk8o3z8od-2{list-style-type:none}.lst-kix_1gwoiqua32b8-0>li:before{content:"\0025cf  "}.lst-kix_1gwoiqua32b8-1>li:before{content:"\0025cb  "}.lst-kix_1gwoiqua32b8-2>li:before{content:"\0025a0  "}.lst-kix_q1mwnxtilbdj-0>li{counter-increment:lst-ctn-kix_q1mwnxtilbdj-0}ol.lst-kix_jii9o7uqpkrd-5.start{counter-reset:lst-ctn-kix_jii9o7uqpkrd-5 0}.lst-kix_ucchapg7uvfq-8>li{counter-increment:lst-ctn-kix_ucchapg7uvfq-8}ol.lst-kix_sqabk8o3z8od-4.start{counter-reset:lst-ctn-kix_sqabk8o3z8od-4 0}.lst-kix_ucchapg7uvfq-6>li{counter-increment:lst-ctn-kix_ucchapg7uvfq-6}.lst-kix_q1mwnxtilbdj-2>li{counter-increment:lst-ctn-kix_q1mwnxtilbdj-2}ol.lst-kix_jii9o7uqpkrd-4.start{counter-reset:lst-ctn-kix_jii9o7uqpkrd-4 0}.lst-kix_jii9o7uqpkrd-5>li{counter-increment:lst-ctn-kix_jii9o7uqpkrd-5}.lst-kix_ucchapg7uvfq-7>li:before{content:"" counter(lst-ctn-kix_ucchapg7uvfq-7,lower-latin) ". "}.lst-kix_ucchapg7uvfq-8>li:before{content:"" counter(lst-ctn-kix_ucchapg7uvfq-8,lower-roman) ". "}.lst-kix_ucchapg7uvfq-6>li:before{content:"" counter(lst-ctn-kix_ucchapg7uvfq-6,decimal) ". "}ol.lst-kix_sqabk8o3z8od-3.start{counter-reset:lst-ctn-kix_sqabk8o3z8od-3 0}.lst-kix_ucchapg7uvfq-1>li:before{content:"" counter(lst-ctn-kix_ucchapg7uvfq-1,lower-latin) ". "}.lst-kix_sqabk8o3z8od-2>li{counter-increment:lst-ctn-kix_sqabk8o3z8od-2}.lst-kix_ucchapg7uvfq-2>li:before{content:"" counter(lst-ctn-kix_ucchapg7uvfq-2,lower-roman) ". "}.lst-kix_ucchapg7uvfq-3>li:before{content:"" counter(lst-ctn-kix_ucchapg7uvfq-3,decimal) ". "}.lst-kix_ucchapg7uvfq-4>li:before{content:"" counter(lst-ctn-kix_ucchapg7uvfq-4,lower-latin) ". "}.lst-kix_ucchapg7uvfq-5>li:before{content:"" counter(lst-ctn-kix_ucchapg7uvfq-5,lower-roman) ". "}.lst-kix_jii9o7uqpkrd-7>li{counter-increment:lst-ctn-kix_jii9o7uqpkrd-7}ul.lst-kix_43rb37omyu3r-7{list-style-type:none}ul.lst-kix_43rb37omyu3r-8{list-style-type:none}ol.lst-kix_ucchapg7uvfq-6.start{counter-reset:lst-ctn-kix_ucchapg7uvfq-6 0}ul.lst-kix_43rb37omyu3r-5{list-style-type:none}ul.lst-kix_43rb37omyu3r-6{list-style-type:none}ol.lst-kix_jii9o7uqpkrd-6.start{counter-reset:lst-ctn-kix_jii9o7uqpkrd-6 0}ol.lst-kix_sqabk8o3z8od-5.start{counter-reset:lst-ctn-kix_sqabk8o3z8od-5 0}.lst-kix_9ffndsr7zdrj-3>li:before{content:"\0025cf  "}ul.lst-kix_43rb37omyu3r-0{list-style-type:none}.lst-kix_ucchapg7uvfq-3>li{counter-increment:lst-ctn-kix_ucchapg7uvfq-3}.lst-kix_9ffndsr7zdrj-1>li:before{content:"\0025cb  "}ul.lst-kix_43rb37omyu3r-3{list-style-type:none}ol.lst-kix_q1mwnxtilbdj-1{list-style-type:none}ul.lst-kix_43rb37omyu3r-4{list-style-type:none}ol.lst-kix_q1mwnxtilbdj-0{list-style-type:none}ul.lst-kix_43rb37omyu3r-1{list-style-type:none}ul.lst-kix_43rb37omyu3r-2{list-style-type:none}ol.lst-kix_q1mwnxtilbdj-5{list-style-type:none}ol.lst-kix_q1mwnxtilbdj-4{list-style-type:none}ol.lst-kix_q1mwnxtilbdj-3{list-style-type:none}ol.lst-kix_q1mwnxtilbdj-2{list-style-type:none}ol.lst-kix_q1mwnxtilbdj-8{list-style-type:none}ol.lst-kix_q1mwnxtilbdj-7{list-style-type:none}ol.lst-kix_q1mwnxtilbdj-6{list-style-type:none}.lst-kix_jii9o7uqpkrd-0>li:before{content:"" counter(lst-ctn-kix_jii9o7uqpkrd-0,decimal) ". "}ol.lst-kix_sqabk8o3z8od-8.start{counter-reset:lst-ctn-kix_sqabk8o3z8od-8 0}ol.lst-kix_ucchapg7uvfq-3.start{counter-reset:lst-ctn-kix_ucchapg7uvfq-3 0}ol.lst-kix_q1mwnxtilbdj-7.start{counter-reset:lst-ctn-kix_q1mwnxtilbdj-7 0}.lst-kix_ucchapg7uvfq-5>li{counter-increment:lst-ctn-kix_ucchapg7uvfq-5}.lst-kix_sqabk8o3z8od-6>li{counter-increment:lst-ctn-kix_sqabk8o3z8od-6}.lst-kix_1gwoiqua32b8-7>li:before{content:"\0025cb  "}.lst-kix_q1mwnxtilbdj-1>li{counter-increment:lst-ctn-kix_q1mwnxtilbdj-1}ol.lst-kix_ucchapg7uvfq-4.start{counter-reset:lst-ctn-kix_ucchapg7uvfq-4 0}.lst-kix_1gwoiqua32b8-3>li:before{content:"\0025cf  "}.lst-kix_1gwoiqua32b8-5>li:before{content:"\0025a0  "}.lst-kix_jii9o7uqpkrd-8>li:before{content:"" counter(lst-ctn-kix_jii9o7uqpkrd-8,lower-roman) ". "}ol.lst-kix_sqabk8o3z8od-8{list-style-type:none}.lst-kix_jii9o7uqpkrd-2>li:before{content:"" counter(lst-ctn-kix_jii9o7uqpkrd-2,lower-roman) ". "}.lst-kix_jii9o7uqpkrd-4>li:before{content:"" counter(lst-ctn-kix_jii9o7uqpkrd-4,lower-latin) ". "}ol.lst-kix_q1mwnxtilbdj-8.start{counter-reset:lst-ctn-kix_q1mwnxtilbdj-8 0}ol.lst-kix_sqabk8o3z8od-5{list-style-type:none}ol.lst-kix_sqabk8o3z8od-4{list-style-type:none}ol.lst-kix_sqabk8o3z8od-7{list-style-type:none}ol.lst-kix_sqabk8o3z8od-6{list-style-type:none}ol.lst-kix_sqabk8o3z8od-7.start{counter-reset:lst-ctn-kix_sqabk8o3z8od-7 0}.lst-kix_jii9o7uqpkrd-6>li:before{content:"" counter(lst-ctn-kix_jii9o7uqpkrd-6,decimal) ". "}ul.lst-kix_1gwoiqua32b8-2{list-style-type:none}ul.lst-kix_1gwoiqua32b8-3{list-style-type:none}ul.lst-kix_1gwoiqua32b8-4{list-style-type:none}ul.lst-kix_1gwoiqua32b8-5{list-style-type:none}ul.lst-kix_1gwoiqua32b8-6{list-style-type:none}ul.lst-kix_1gwoiqua32b8-7{list-style-type:none}ul.lst-kix_1gwoiqua32b8-8{list-style-type:none}.lst-kix_sqabk8o3z8od-7>li{counter-increment:lst-ctn-kix_sqabk8o3z8od-7}.lst-kix_9ffndsr7zdrj-5>li:before{content:"\0025a0  "}ul.lst-kix_1gwoiqua32b8-0{list-style-type:none}.lst-kix_jii9o7uqpkrd-6>li{counter-increment:lst-ctn-kix_jii9o7uqpkrd-6}ul.lst-kix_1gwoiqua32b8-1{list-style-type:none}ol.lst-kix_jii9o7uqpkrd-7.start{counter-reset:lst-ctn-kix_jii9o7uqpkrd-7 0}.lst-kix_ucchapg7uvfq-4>li{counter-increment:lst-ctn-kix_ucchapg7uvfq-4}.lst-kix_9ffndsr7zdrj-7>li:before{content:"\0025cb  "}.lst-kix_jii9o7uqpkrd-0>li{counter-increment:lst-ctn-kix_jii9o7uqpkrd-0}ol.lst-kix_ucchapg7uvfq-5.start{counter-reset:lst-ctn-kix_ucchapg7uvfq-5 0}ol.lst-kix_sqabk8o3z8od-6.start{counter-reset:lst-ctn-kix_sqabk8o3z8od-6 0}.lst-kix_q1mwnxtilbdj-7>li{counter-increment:lst-ctn-kix_q1mwnxtilbdj-7}ol{margin:0;padding:0}table td,table th{padding:0}.c0{margin-left:108pt;padding-top:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c12{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Consolas";font-style:normal}.c28{margin-left:18pt;padding-top:3pt;padding-bottom:4pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c21{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:"Arial";font-style:normal}.c16{color:#434343;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:14pt;font-family:"Arial";font-style:normal}.c14{margin-left:18pt;padding-top:3pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c24{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:18pt;font-family:"Arial";font-style:normal}.c3{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c22{color:#000000;font-weight:400;text-decoration:line-through;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c5{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c27{padding-top:4pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c20{padding-top:10pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c23{color:#000000;font-weight:400;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c26{padding-top:0pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c15{color:#000000;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c11{padding-top:18pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;text-align:left}.c19{padding-top:16pt;padding-bottom:4pt;line-height:1.15;page-break-after:avoid;text-align:left}.c8{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c13{font-weight:400;font-family:"Consolas"}.c7{margin-left:72pt;padding-left:0pt}.c1{color:#1155cc;text-decoration:underline}.c6{padding:0;margin:0}.c4{color:inherit;text-decoration:inherit}.c9{margin-left:36pt;padding-left:0pt}.c25{text-decoration:line-through}.c2{text-decoration:underline}.c10{font-weight:700}.c17{height:11pt}.c18{margin-left:36pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style><div><p class="c26"><span class="c24">&nbsp; </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 57.20px; height: 52.50px;"><img alt="" src="./GitLab.com Database Incident - 2017_01_31_files/-akWRRqzOF_bCsm7QwodRUtkzg3D1locqbmy1lbfhF5-1uvMunUcHKSMWnMjIaPmqmkMmZdG7yuC-d-6Mi7aYP9Oheaj8_hjR_ijnLXzQvlal3GMqC2p3zPGBnNs0_hZRw" style="width: 57.20px; height: 52.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c26"><span class="c24">&nbsp; &nbsp;GitLab.com Database Incident - 2017/01/31</span></p></div><p class="c5"><span class="c15 c10">Note: This incident affected the database (including issues and merge requests) but not the git repo's (repositories and wikis).</span></p><p class="c5 c17"><span class="c15 c10"></span></p><p class="c5"><span class="c1 c10"><a class="c4" href="https://www.google.com/url?q=http://www.youtube.com/c/Gitlab/live&amp;sa=D&amp;ust=1485980274907000&amp;usg=AFQjCNHcBbBb4Jg2W-KT_wxPdyyK9LyK-Q">YouTube Live stream</a></span><span class="c10">&nbsp;- Follow us live debating and problem solving!</span></p><p class="c5 c17"><span class="c15 c10"></span></p><p class="c27"><span class="c10"><a class="c4" href="https://docs.google.com/document/d/1GCK53YDcBWQveod9kfzW-VCxIABGiryG7_z_6jHdVik/pub#h.eus5qlwdvknq">Timeline (all times UTC)</a></span><span class="c10">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c10"><a class="c4" href="https://docs.google.com/document/d/1GCK53YDcBWQveod9kfzW-VCxIABGiryG7_z_6jHdVik/pub#h.eus5qlwdvknq">1</a></span></p><p class="c20"><span class="c10"><a class="c4" href="https://docs.google.com/document/d/1GCK53YDcBWQveod9kfzW-VCxIABGiryG7_z_6jHdVik/pub#h.767ry7jcb8eh">Recovery - 2017/01/31 23:00 (backup from ±17:20 UTC)</a></span><span class="c10">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c10"><a class="c4" href="https://docs.google.com/document/d/1GCK53YDcBWQveod9kfzW-VCxIABGiryG7_z_6jHdVik/pub#h.767ry7jcb8eh">2</a></span></p><p class="c20"><span class="c10"><a class="c4" href="https://docs.google.com/document/d/1GCK53YDcBWQveod9kfzW-VCxIABGiryG7_z_6jHdVik/pub#h.dgc3wwb1l1t6">Problems Encountered</a></span><span class="c10">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c10"><a class="c4" href="https://docs.google.com/document/d/1GCK53YDcBWQveod9kfzW-VCxIABGiryG7_z_6jHdVik/pub#h.dgc3wwb1l1t6">4</a></span></p><p class="c20"><span class="c10"><a class="c4" href="https://docs.google.com/document/d/1GCK53YDcBWQveod9kfzW-VCxIABGiryG7_z_6jHdVik/pub#h.sszg8ld2no45">External help</a></span><span class="c10">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c10"><a class="c4" href="https://docs.google.com/document/d/1GCK53YDcBWQveod9kfzW-VCxIABGiryG7_z_6jHdVik/pub#h.sszg8ld2no45">5</a></span></p><p class="c14"><span><a class="c4" href="https://docs.google.com/document/d/1GCK53YDcBWQveod9kfzW-VCxIABGiryG7_z_6jHdVik/pub#h.ra5p5xmzfz8s">Hugops (please add kind reactions here, from twitter and elsewhere)</a></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span><a class="c4" href="https://docs.google.com/document/d/1GCK53YDcBWQveod9kfzW-VCxIABGiryG7_z_6jHdVik/pub#h.ra5p5xmzfz8s">5</a></span></p><p class="c14"><span><a class="c4" href="https://docs.google.com/document/d/1GCK53YDcBWQveod9kfzW-VCxIABGiryG7_z_6jHdVik/pub#h.k95cblaqd8p1">Stephen Frost</a></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span><a class="c4" href="https://docs.google.com/document/d/1GCK53YDcBWQveod9kfzW-VCxIABGiryG7_z_6jHdVik/pub#h.k95cblaqd8p1">5</a></span></p><p class="c28"><span><a class="c4" href="https://docs.google.com/document/d/1GCK53YDcBWQveod9kfzW-VCxIABGiryG7_z_6jHdVik/pub#h.tdixc7hmw3tc">Sam McLeod</a></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span><a class="c4" href="https://docs.google.com/document/d/1GCK53YDcBWQveod9kfzW-VCxIABGiryG7_z_6jHdVik/pub#h.tdixc7hmw3tc">5</a></span></p><h2 class="c11" id="h.f7s0s6achnev"><span class="c21">Impact</span></h2><ol class="c6 lst-kix_sqabk8o3z8od-0 start" start="1"><li class="c5 c9"><span class="c3">±6 hours of data loss</span></li><li class="c5 c9"><span class="c3">4613 regular projects, 74 forks, and 350 imports are lost (roughly); 5037 projects in total. Since Git repositories are NOT lost, we can recreate all of the projects whose user/group existed before the data loss, but we cannot restore any of these projects issues, etc.</span></li><li class="c5 c9"><span class="c3">±4979 (so ±5000) comments lost</span></li><li class="c5 c9"><span class="c3">707 users lost potentially, hard to tell for certain from the Kibana logs</span></li><li class="c5 c9"><span class="c3">Unconfirmed: loss of all webhooks (there’s a potential snapshot that might allow us to restore them)</span></li></ol><h2 class="c11" id="h.eus5qlwdvknq"><span class="c21">Timeline (all times UTC)</span></h2><ol class="c6 lst-kix_q1mwnxtilbdj-0 start" start="1"><li class="c5 c9"><span class="c15 c10">2017/01/31 16:00/17:00 - 21:00</span></li></ol><ol class="c6 lst-kix_q1mwnxtilbdj-1 start" start="1"><li class="c5 c7"><span class="c3">YP is working on setting up pgpool and replication in staging, creates an LVM snapshot to get up to date production data to staging, hoping he can re-use this for bootstrapping other replicas. This was done roughly 6 hours before data loss.</span></li><li class="c5 c7"><span class="c3">Getting replication to work is proving to be problematic and time consuming (estimated at ±20 hours just for the initial pg_basebackup sync). The LVM snapshot is not usable on the other replicas as far as YP could figure out. Work is interrupted due to this (as YP needs the help of another collegue who’s not working this day), and due to spam/high load on GitLab.com</span></li></ol><ol class="c6 lst-kix_q1mwnxtilbdj-0" start="2"><li class="c5 c9"><span class="c10">2017/01/31 21:00 </span><span>- </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=http://monitor.gitlab.net/dashboard/db/postgres-stats?from%3D1485889073596%26to%3D1485897722398&amp;sa=D&amp;ust=1485980274925000&amp;usg=AFQjCNHr8vtXVQncxjRYEoIkUazEv_T1Vg">Spike in database load due to spam users</a></span><span>&nbsp;- </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/gitlabstatus/status/826544148949909506&amp;sa=D&amp;ust=1485980274927000&amp;usg=AFQjCNEMl2XrYefBAd4hVedM0lOgyjPPVA">Twitter</a></span><span>&nbsp;|</span><span>&nbsp;</span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://gitlab.slack.com/archives/infrastructure/p1485896980015093&amp;sa=D&amp;ust=1485980274927000&amp;usg=AFQjCNGAfaicXvAO3p7fvLNJxqBbfTq7mQ">Slack</a></span><span class="c3">&nbsp;</span></li></ol><ol class="c6 lst-kix_q1mwnxtilbdj-1 start" start="1"><li class="c5 c7"><span class="c3">Blocked users based on IP address</span></li><li class="c5 c7"><span>Removed a</span><span>&nbsp;</span><span class="c3">user for using a repository as some form of CDN, resulting in 47 000 IPs signing in using the same account (causing high DB load). This was communicated with the infrastructure and support team.</span></li><li class="c5 c7"><span>Removed users for spamming (by creating snippets) - </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://gitlab.slack.com/archives/support/p1485900555017129&amp;sa=D&amp;ust=1485980274931000&amp;usg=AFQjCNHyQe9k2mc8NZxBPMsG89QX9dxLNQ">Slack</a></span></li><li class="c5 c7"><span>Database load goes back to normal, some manual PostgreSQL vacuuming is applied here and there to catch up with a large amount of dead tuples.</span></li></ol><ol class="c6 lst-kix_q1mwnxtilbdj-0" start="3"><li class="c5 c9"><span class="c10">2017/01/31 22:00</span><span>&nbsp;- </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=http://monitor.gitlab.net/dashboard/db/postgres-stats?from%3D1485897525856%26to%3D1485900295390%26panelId%3D11%26fullscreen&amp;sa=D&amp;ust=1485980274934000&amp;usg=AFQjCNECIsiRNPvucFUJCSs8sHCKMEVZlw">Replication lag alert triggered</a></span><span>&nbsp;in pagerduty </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://gitlab.slack.com/archives/infrastructure/p1485899770015360&amp;sa=D&amp;ust=1485980274935000&amp;usg=AFQjCNE87ZlSZW-ipca09raFP0h3vQR01Q">Slack</a></span></li></ol><ol class="c6 lst-kix_q1mwnxtilbdj-1 start" start="1"><li class="c5 c7"><span class="c3">Attempts to fix db2, it’s lagging behind by about 4 GB at this point</span></li><li class="c5 c7"><span>db2.cluster refuses to replicate, </span><span class="c13">/var/opt/gitlab/postgresql/data</span><span class="c3">&nbsp;is wiped to ensure a clean replication</span></li><li class="c5 c7"><span>db2.cluster refuses to connect to db1, complaining about </span><span class="c13">max_wal_senders</span><span class="c3">&nbsp;being too low. This setting is used to limit the number of WAL (= replication) clients</span></li><li class="c5 c7"><span>YP adjusts </span><span class="c13">max_wal_senders</span><span>&nbsp;to </span><span class="c13">32</span><span class="c3">&nbsp;on db1, restarts PostgreSQL</span></li><li class="c5 c7"><span class="c3">PostgreSQL complains about too many semaphores being open, refusing to start</span></li><li class="c5 c7"><span>YP adjusts </span><span class="c13">max_connections</span><span>&nbsp;to </span><span class="c13">2000</span><span>&nbsp;from </span><span class="c13">8000</span><span class="c3">, PostgreSQL starts again (despite 8000 having been used for almost a year)</span></li><li class="c5 c7"><span class="c3">db2.cluster still refuses to replicate, though it no longer complains about connections; instead it just hangs there not doing anything</span></li><li class="c5 c7"><span>At this point frustration begins to kick in. Earlier this night YP </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://gitlab.slack.com/archives/infrastructure/p1485900765015428&amp;sa=D&amp;ust=1485980274943000&amp;usg=AFQjCNFkqcr1j-upEPuQ-YsOpSez0ulNUw">explicitly mentioned</a></span><span class="c3">&nbsp;he was going to sign off as it was getting late (23:00 or so local time), but didn’t due to the replication problems popping up all of a sudden.</span></li></ol><ol class="c6 lst-kix_q1mwnxtilbdj-0" start="4"><li class="c5 c9"><span class="c15 c10">2017/01/31 23:00-ish</span></li></ol><ol class="c6 lst-kix_q1mwnxtilbdj-1 start" start="1"><li class="c5 c7"><span>YP </span><span>thinks that perhaps </span><span class="c13">pg_basebackup</span><span>&nbsp;is being super pedantic about there being an empty data directory, decides to remove the directory. After a second or two he notices he ran it on db1.cluster.gitlab.com, instead of db2.cluster.gitlab.com</span></li><li class="c5 c7"><span>2017/01/31 23:27 YP - terminates the removal, but it’s too late. Of around 310 GB only about 4.5 GB is left - </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://gitlab.slack.com/archives/infrastructure/p1485905230015681&amp;sa=D&amp;ust=1485980274947000&amp;usg=AFQjCNFSQ3ZWvs8cOkkyxzASAxo8Lm2m-Q">Slack</a></span></li></ol><h2 class="c11" id="h.767ry7jcb8eh"><span class="c21">Recovery - 2017/01/31 23:00 (backup from ±17:20 UTC)</span></h2><ol class="c6 lst-kix_ucchapg7uvfq-0 start" start="1"><li class="c5 c9"><span class="c10">Suggested recovery solutions</span><span class="c3">:</span></li></ol><ol class="c6 lst-kix_ucchapg7uvfq-1 start" start="1"><li class="c5 c7"><span>Migrate </span><span class="c2">db1.staging.gitlab.com </span><span class="c3">data to GitLab.com (±6 hours old)</span></li></ol><ol class="c6 lst-kix_ucchapg7uvfq-2 start" start="1"><li class="c0"><span class="c3">CW: Problem with web hooks, these are removed as part of the staging sync.</span></li></ol><ol class="c6 lst-kix_ucchapg7uvfq-1" start="2"><li class="c5 c7"><span class="c3">Restore LVM snapshot (6 hours old)</span></li><li class="c5 c7"><span>Sid: try to undelete files?</span></li></ol><ol class="c6 lst-kix_ucchapg7uvfq-2 start" start="1"><li class="c0"><span>CW: </span><span>Not possible</span><span>! `</span><span class="c13">rm -Rvf</span><span class="c3">` Sid: OK</span></li><li class="c0"><span>JEJ: Probably too late, but isn't it sometimes possible if you make the disk read-only quickly enough? Also might still have file descriptor if the file was in use by a running process according to </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=http://unix.stackexchange.com/a/101247/213510&amp;sa=D&amp;ust=1485980274954000&amp;usg=AFQjCNEB9Zf7tOgaYYYKwI0dfhxSRz4dgA">http://unix.stackexchange.com/a/101247/213510</a></span></li><li class="c0"><span class="c3">YP: PostgreSQL doesn't keep all files open at all times, so that wouldn't work. Also, Azure is apparently also really good in removing data quickly, but not at sending it over to replicas. In other words, the data can't be recovered from the disk itself.</span></li><li class="c0"><span class="c3">SH: It appears the db1 staging server runs a separate PostgreSQL process under the gitlab_replicator directory that streams production data from db2. Due to replication lag, db2 was killed 2016-01-31 05:53, which caused the gitlab_replicator to stop. The good news is that the data up until that point looks unaltered, so we may be able to recover the WebHook data.</span></li></ol><p class="c5 c17"><span class="c3"></span></p><ol class="c6 lst-kix_ucchapg7uvfq-0" start="2"><li class="c5 c9"><span class="c10">Action taken</span><span class="c3">: </span></li></ol><ol class="c6 lst-kix_ucchapg7uvfq-1 start" start="1"><li class="c5 c7"><span class="c3">2017/02/01 23:00 - 00:00: The decision is made to restore data from db1.staging.gitlab.com to db1.cluster.gitlab.com (production). While 6 hours old and without webhooks, it’s the only available snapshot. YP says it’s best for him not to run anything with sudo any more today, handing off the restoring to JN.</span></li><li class="c5 c7"><span>2017/02/01 00:36 - JN: Backup </span><span class="c2">db1.staging.gitlab.com </span><span class="c3">data</span></li><li class="c5 c7"><span>2017/02/01 00:55 - JN: Mount </span><span class="c2">db1.staging.gitlab.com</span><span>&nbsp;on </span><span class="c2 c23">db1.cluster.gitlab.com</span></li></ol><ol class="c6 lst-kix_ucchapg7uvfq-2 start" start="1"><li class="c0"><span>Copy data from </span><span class="c2">staging</span><span>&nbsp;</span><span class="c13">/var/opt/gitlab/postgresql/data/</span><span>&nbsp;to </span><span class="c2">production</span><span>&nbsp;</span><span class="c12">/var/opt/gitlab/postgresql/data/</span></li></ol><ol class="c6 lst-kix_ucchapg7uvfq-1" start="4"><li class="c5 c7"><span>2017/02/01 01:05 - JN: nfs-share01 server commandeered as temp storage place in </span><span class="c12">/var/opt/gitlab/db-meltdown</span></li><li class="c5 c7"><span>2017/02/01 01:18 - JN: Copy of remaining production data, including </span><span class="c13">pg_xlog</span><span>&nbsp;tar’ed up as ‘</span><span class="c13">20170131-db-meltodwn-backup.tar.gz</span><span class="c3">’</span></li><li class="c5 c7"><span class="c3">2017/02/01 01:58 - JN: Start rsync from stage to production</span></li><li class="c5 c7"><span>2017/02/01 02:00 - CW: Updated deploy page to explain the situation. </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://drive.google.com/open?id%3D0B_4wYK1qcPT1TlJGRXR0Z0poWWc&amp;sa=D&amp;ust=1485980274964000&amp;usg=AFQjCNH8ZAgBADRd7Ai7Ut6ld64Y4rj4Mg">Link</a></span><span class="c3">&nbsp;</span></li><li class="c5 c7"><span class="c3">2017/02/01 03:00 - AR: rsync progress approximately 50% (by # of files)</span></li><li class="c5 c7"><span class="c3">2017/02/01 04:00 - JN: rsync progress approximately 56.4% (by # of files). Data transfer is slowed by two factors: network I/O between us-east and us-east-2 and disk throughput cap on staging server (60 Mb/s).</span></li><li class="c5 c7"><span>2017/02/01 07:00 - JN: Found a copy of pre-sanitized data in on db1 staging in </span><span class="c13">/var/opt/gitlab_replicator/postgresql.</span><span>&nbsp;Started </span><span class="c13">db-crutch</span><span class="c3">&nbsp;VM in us-east to backup this data to another host. Unfortunately, this system maxes out at 120 GB RAM and cannot support the production load. This copy will be used to check the database state and export the WebHook data.</span></li><li class="c5 c7"><span class="c3">2017/02/01 08:07 - JN: Data transfer has been slow: total transfer progress by data size is 42%.</span></li><li class="c5 c7"><span class="c3">2017/02/02 16:28 - JN: Data transfer complete</span></li><li class="c5 c7"><span>2017/02/02 16:45 - Following restore procedures below</span></li></ol><p class="c5 c17"><span class="c10 c15"></span></p><ol class="c6 lst-kix_ucchapg7uvfq-0" start="3"><li class="c5 c9"><span class="c15 c10">Restore procedure</span></li></ol><ol class="c6 lst-kix_ucchapg7uvfq-1 start" start="1"><li class="c5 c7"><span class="c3">[x] - Make a snapshot of the DB1 server - or 2 or 3 - done at 16:36 UTC</span></li><li class="c5 c7"><span class="c3">[x] - Upgrade db1.cluster.gitlab.com to PostgreSQL 9.6.1 as it’s still running 9.6.0 while staging uses 9.6.1 (PostgreSQL might not start otherwise) - </span></li></ol><ol class="c6 lst-kix_ucchapg7uvfq-2 start" start="1"><li class="c0"><span class="c3">To install 8.16.3-EE.1</span></li><li class="c0"><span class="c3">YP move from chef-noop to chef-client (was disabled manually)</span></li><li class="c0"><span class="c3">YP running chef-client in the host @ 16:45</span></li><li class="c0 c17"><span class="c3"></span></li></ol><ol class="c6 lst-kix_ucchapg7uvfq-1" start="3"><li class="c5 c7"><span class="c3">[x] - Start the DB - 16:53 UTC</span></li></ol><ol class="c6 lst-kix_ucchapg7uvfq-2 start" start="1"><li class="c0"><span class="c3">Monitor that it starts and becomes available.</span></li><li class="c0"><span class="c3">It’s back up</span></li></ol><ol class="c6 lst-kix_ucchapg7uvfq-1" start="4"><li class="c5 c7"><span class="c3">[x] - Update the Sentry DSN on the DB so errors don’t go to staging.</span></li><li class="c5 c7"><span>[x] - Increment IDs on all tables by 10k to be on the safe side when creating new projects/notes. Done using </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://gist.github.com/anonymous/23e3c0d41e2beac018c4099d45ec88f5&amp;sa=D&amp;ust=1485980274975000&amp;usg=AFQjCNF1_MOH5FNEBU0wxfe7RhOwIwKZoA">https://gist.github.com/anonymous/23e3c0d41e2beac018c4099d45ec88f5</a></span><span class="c3">, which reads from a text file containing all sequences (one per line)</span></li><li class="c5 c7"><span class="c3">[x] - Flush Rails/Redis cache</span></li><li class="c5 c7"><span class="c3">[x] - Attempt to restore webhooks, if possible</span></li></ol><ol class="c6 lst-kix_ucchapg7uvfq-2 start" start="1"><li class="c0"><span class="c3">[x] Start staging using the snapshot prior to webhook removal</span></li><li class="c0"><span class="c3">[x] Check if webhooks are present</span></li><li class="c0"><span class="c3">[x] Generate SQL dump (data only) of the “web_hooks” table (if there is data)</span></li><li class="c0"><span class="c3">[x] Copy SQL dump to the production server</span></li><li class="c0"><span class="c3">[x] Import SQL dump into the production database</span></li></ol><ol class="c6 lst-kix_ucchapg7uvfq-1" start="8"><li class="c5 c7"><span class="c3">[x] - Test if workers can connect via a Rails console</span></li><li class="c5 c7"><span class="c3">[x] - Gradually start workers</span></li><li class="c5 c7"><span class="c3">[x] - Disable deploy page</span></li><li class="c5 c7"><span class="c3">[x] - Tweet from @gitlabstatus</span></li><li class="c5 c7"><span class="c3">[ ] - Create outage issue describing future plans/actions (YP will do this after dinner)</span></li><li class="c5 c7"><span class="c3">[ ] - Create new Project records for Git repositories without a Project record, where the namespace path corresponds to an existing user/group.</span></li></ol><ol class="c6 lst-kix_ucchapg7uvfq-2 start" start="1"><li class="c0"><span>PC - </span><span class="c22">I’m getting a list of these repos so we can then check on the DB that they do exists or not - it’s there</span></li></ol><ol class="c6 lst-kix_ucchapg7uvfq-1" start="14"><li class="c5 c7"><span class="c3">[ ] - Delete repositories for unknown (lost) namespaces</span></li></ol><ol class="c6 lst-kix_ucchapg7uvfq-2 start" start="1"><li class="c0"><span class="c3">AR - working on script based on previous point data.</span></li></ol><ol class="c6 lst-kix_ucchapg7uvfq-1" start="15"><li class="c5 c7"><span class="c3">[x] - Remove the spam users again (so they don’t cause problems again)</span></li></ol><ol class="c6 lst-kix_ucchapg7uvfq-2 start" start="1"><li class="c0"><span class="c3">[x] CDN user with 47 000 IPs</span></li></ol><p class="c5 c17 c18"><span class="c3"></span></p><ol class="c6 lst-kix_ucchapg7uvfq-0" start="4"><li class="c5 c9"><span class="c10">TODO after data restored:</span></li></ol><ol class="c6 lst-kix_ucchapg7uvfq-1 start" start="1"><li class="c5 c7"><span class="c3">Create issue to change terminal PS1 format/colours to make it clear whether you’re using production or staging (red production, yellow staging)</span></li><li class="c5 c7"><span class="c3">Show the full hostname in the bash prompt for all users by default (e.g., “db1.staging.gitlab.com” instead of just “db1”)</span></li><li class="c5 c7"><span>Somehow disallow </span><span class="c13">rm -rf</span><span class="c3">&nbsp;for the PostgreSQL data directory? Unsure if this is feasible, or necessary once we have proper backups</span></li><li class="c5 c7"><span class="c3">Add alerting for backups: check S3 storage etc. </span></li><li class="c5 c7"><span class="c3">Add a graph with the size of the backups over time, page when it goes down by more than 10%.</span></li><li class="c5 c7"><span class="c25">Consider adding a last successful backup time in DB so admins can see this easily</span><span>&nbsp;(suggested by customer in </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://gitlab.zendesk.com/agent/tickets/58274&amp;sa=D&amp;ust=1485980274989000&amp;usg=AFQjCNFcUnnhM7G-ICok8rZht-AlCgMNdw">https://gitlab.zendesk.com/agent/tickets/58274</a></span><span class="c3">)</span></li><li class="c5 c7"><span>Figure out why PostgreSQL suddenly had problems with </span><span class="c13">max_connections</span><span class="c3">&nbsp;being set to 8000, despite it having been set to that since 2016-05-13. A large portion of frustration arose because of this suddenly becoming a problem.</span></li><li class="c5 c7"><span class="c3">Add server hostname to bash PS1 (avoid running commands on the wrong host)</span></li><li class="c5 c7"><span class="c3">Look into increasing replication thresholds via WAL archiving</span></li><li class="c5 c7"><span>Create </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://docs.google.com/document/d/1hOzpk3dOhzrlvZH-TrjCGZHC2p_a5Rb6C8mFDcZU0W8/pub&amp;sa=D&amp;ust=1485980275075000&amp;usg=AFQjCNF1-DpLHs8IWL6PnRWx9rr8nINu8w">troubleshooting guide</a></span><span class="c3">&nbsp;for problems users might encounter after we go online</span></li><li class="c5 c7"><span class="c3">PITR - also will be useful after failed upgrades</span></li><li class="c5 c7"><span>Experiment with moving data from one datacenter to another via </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://docs.microsoft.com/en-us/azure/storage/storage-use-azcopy&amp;sa=D&amp;ust=1485980275077000&amp;usg=AFQjCNEZunWGxSTE4-YBfrKLOePpDu9Hog">AzCopy</a></span><span class="c3">: Microsoft says this should be faster than rsync</span></li></ol><h2 class="c11" id="h.dgc3wwb1l1t6"><span>Problems Encountered</span></h2><ol class="c6 lst-kix_jii9o7uqpkrd-0 start" start="1"><li class="c5 c9"><span class="c3">LVM snapshots are by default only taken once every 24 hours. YP happened to run one manually about 6 hours prior to the outage</span></li><li class="c5 c9"><span class="c3">Regular backups seem to also only be taken once per 24 hours, though YP has not yet been able to figure out where they are stored. According to JN these don’t appear to be working, producing files only a few bytes in size.</span></li></ol><ol class="c6 lst-kix_jii9o7uqpkrd-1 start" start="1"><li class="c5 c7"><span class="c3">SH: It looks like pg_dump may be failing because PostgreSQL 9.2 binaries are being run instead of 9.6 binaries. This happens because omnibus only uses Pg 9.6 if data/PG_VERSION is set to 9.6, but on workers this file does not exist. As a result it defaults to 9.2, failing silently. No SQL dumps were made as a result. Fog gem may have cleaned out older backups.</span></li></ol><ol class="c6 lst-kix_jii9o7uqpkrd-0" start="3"><li class="c5 c9"><span class="c3">Disk snapshots in Azure are enabled for the NFS server, but not for the DB servers.</span></li><li class="c5 c9"><span class="c3">The synchronisation process removes webhooks once it has synchronised data to staging. Unless we can pull these from a regular backup from the past 24 hours they will be lost</span></li><li class="c5 c9"><span class="c3">The replication procedure is super fragile, prone to error, relies on a handful of random shell scripts, and is badly documented</span></li></ol><ol class="c6 lst-kix_jii9o7uqpkrd-1 start" start="1"><li class="c5 c7"><span class="c3">SH: We learned later the staging DB refresh works by taking a snapshot of the gitlab_replicator directory, prunes the replication configuration, and starts up a separate PostgreSQL server.</span></li></ol><ol class="c6 lst-kix_jii9o7uqpkrd-0" start="6"><li class="c5 c9"><span class="c3">Our backups to S3 apparently don’t work either: the bucket is empty</span></li><li class="c5 c9"><span class="c3">We don’t have solid alerting/paging for when backups fails, we are seeing this in the dev host too now.</span></li></ol><p class="c5 c17"><span class="c3"></span></p><p class="c5"><span class="c3">So in other words, out of 5 backup/replication techniques deployed none are working reliably or set up in the first place. =&gt; we're now restoring a backup from 6 hours ago that worked</span></p><p class="c5 c17"><span class="c3"></span></p><p class="c5 c17"><span class="c3"></span></p><p class="c5 c17"><span class="c15 c10"></span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 202.67px;"><img alt="" src="./GitLab.com Database Incident - 2017_01_31_files/BuOlWlAZZUHE3CHJNYX8iKKaE54lvRQngKxrWKZ8AZDcMa6qmswg-PnW6FuuBya1SYotkrv-p3Z4NHDPrXMUusqcmh2ZSPK-Yc8rfsjWUkpa4EgDxxvktRcjHBVouSk0nA" style="width: 624.00px; height: 202.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5 c17"><span class="c3"></span></p><p class="c5"><span class="c1"><a class="c4" href="https://www.google.com/url?q=http://monitor.gitlab.net/dashboard/db/postgres-stats?panelId%3D10%26fullscreen%26from%3Dnow-24h%26to%3Dnow&amp;sa=D&amp;ust=1485980275088000&amp;usg=AFQjCNEGLqmR9cBOhpDIAjs9O7CiZSCvrw">http://monitor.gitlab.net/dashboard/db/postgres-stats?panelId=10&amp;fullscreen&amp;from=now-24h&amp;to=now</a></span><span class="c3">&nbsp;</span></p><p class="c5 c17"><span class="c3"></span></p><h2 class="c11" id="h.sszg8ld2no45"><span class="c21">External help</span></h2><h3 class="c19" id="h.ra5p5xmzfz8s"><span class="c16">Hugops (please add kind reactions here, from twitter and elsewhere)</span></h3><ul class="c6 lst-kix_1gwoiqua32b8-0 start"><li class="c5 c9"><span>A Twitter Moment for all the kind tweets: </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/i/moments/826818668948549632&amp;sa=D&amp;ust=1485980275091000&amp;usg=AFQjCNGoBFJJFEtGkq91yIYk0HRBjoGq6w">https://twitter.com/i/moments/826818668948549632</a></span><span>&nbsp;</span></li><li class="c5 c9"><span>Jan Lehnardt </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/janl/status/826717066984116229&amp;sa=D&amp;ust=1485980275093000&amp;usg=AFQjCNF9XtqSuVmEa6K6bA7VwZ2YvGcLnA">https://twitter.com/janl/status/826717066984116229</a></span></li><li class="c5 c9"><span>Buddy CI </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/BuddyGit/status/826704250499633152&amp;sa=D&amp;ust=1485980275095000&amp;usg=AFQjCNGtg2njDy6-VGR15tE_PrcQ8APdDQ">https://twitter.com/BuddyGit/status/826704250499633152</a></span></li><li class="c5 c9"><span>Kent </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/kentchenery/status/826594322870996992&amp;sa=D&amp;ust=1485980275096000&amp;usg=AFQjCNHs3a_49sJnmCthiWJynryQRE0Tzw">https://twitter.com/kentchenery/status/826594322870996992</a></span><span class="c3">&nbsp;</span></li><li class="c5 c9"><span>Lead off </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/LeadOffTeam/status/826599794659450881&amp;sa=D&amp;ust=1485980275097000&amp;usg=AFQjCNGzMyJHfCuhFqvpSoLc9IZ9RFMVbg">https://twitter.com/LeadOffTeam/status/826599794659450881</a></span><span class="c3">&nbsp;</span></li><li class="c5 c9"><span>Mozair </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://news.ycombinator.com/item?id%3D13539779&amp;sa=D&amp;ust=1485980275099000&amp;usg=AFQjCNHm0NsSK4ZfIO1C_qr5YevZb_P-NQ">https://news.ycombinator.com/item?id=13539779</a></span><span class="c3">&nbsp;</span></li><li class="c5 c9"><span>Applicant </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://news.ycombinator.com/item?id%3D13539729&amp;sa=D&amp;ust=1485980275100000&amp;usg=AFQjCNEpbJ3goYBVCZNfMhM7BR42ler4Rg">https://news.ycombinator.com/item?id=13539729</a></span><span class="c3">&nbsp;</span></li><li class="c5 c9"><span>Scott Hanselman </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/shanselman/status/826753118868275200&amp;sa=D&amp;ust=1485980275101000&amp;usg=AFQjCNG_fHkJiMQ_o-i07ctlmRitQP_XIQ">https://twitter.com/shanselman/status/826753118868275200</a></span><span class="c3">&nbsp; </span></li><li class="c5 c9"><span>Dave Long </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/davejlong/status/826817435470815233&amp;sa=D&amp;ust=1485980275103000&amp;usg=AFQjCNFmdMXtxXjqAW9ZRAfMhf5AKV67vw">https://twitter.com/davejlong/status/826817435470815233</a></span><span class="c3">&nbsp;</span></li><li class="c5 c9"><span>Simon Slater </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/skslater/status/826812158184980482&amp;sa=D&amp;ust=1485980275104000&amp;usg=AFQjCNHq8KeoZHDeap2TkT7NcLc1ID2-4A">https://twitter.com/skslater/status/826812158184980482</a></span></li><li class="c5 c9"><span>Zaim M Ramlan </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/zaimramlan/status/826803347764043777&amp;sa=D&amp;ust=1485980275105000&amp;usg=AFQjCNF_Z8r0ucgzR20kbS8Ohtqfk32xOA">https://twitter.com/zaimramlan/status/826803347764043777</a></span><span class="c3">&nbsp;</span></li><li class="c5 c9"><span>Aaron Suggs </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/ktheory/status/826802484467396610&amp;sa=D&amp;ust=1485980275107000&amp;usg=AFQjCNHFqnMQ-4M_zD5f7jIBu1KwXVtF6g">https://twitter.com/ktheory/status/826802484467396610</a></span></li><li class="c5 c9"><span>danedevalcourt </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/danedevalcourt/status/826791663943241728&amp;sa=D&amp;ust=1485980275117000&amp;usg=AFQjCNEXOK7fRdByHUX70zFbpkL6ZXHz6g">https://twitter.com/danedevalcourt/status/826791663943241728</a></span></li><li class="c5 c9"><span>Karl </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/irutsun/status/826786850186608640&amp;sa=D&amp;ust=1485980275118000&amp;usg=AFQjCNFmzCx7pqQFnFft614CIZrwZRNFIQ">https://twitter.com/irutsun/status/826786850186608640</a></span></li><li class="c5 c9"><span>Zac Clay </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/mebezac/status/826781796318707712&amp;sa=D&amp;ust=1485980275119000&amp;usg=AFQjCNGUaI5rNBDGlSyNPvMt1VmcEQi0Fg">https://twitter.com/mebezac/status/826781796318707712</a></span></li><li class="c5 c9"><span>Tim Roberts </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/cirsca/status/826781142581927936&amp;sa=D&amp;ust=1485980275120000&amp;usg=AFQjCNFhxvJpiZvfkIzWqtWmHDrS5KdkVg">https://twitter.com/cirsca/status/826781142581927936</a></span></li><li class="c5 c9"><span>Frans Bouma </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/FransBouma/status/826766417332727809&amp;sa=D&amp;ust=1485980275121000&amp;usg=AFQjCNG-qEgwfZDO5JhWzFM-uefIU6e4mg">https://twitter.com/FransBouma/status/826766417332727809</a></span></li><li class="c5 c9"><span>Roshan Chhetri </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/sai_roshan/status/826764344637616128&amp;sa=D&amp;ust=1485980275122000&amp;usg=AFQjCNE1RYbFUeZbG5MmM5z-po8eRNDtlA">https://twitter.com/sai_roshan/status/826764344637616128</a></span></li><li class="c5 c9"><span>Samuel Boswell </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/sboswell/status/826760159758262273&amp;sa=D&amp;ust=1485980275123000&amp;usg=AFQjCNG4CIyOmpBA1gp7XGWWu8TEVTRMcA">https://twitter.com/sboswell/status/826760159758262273</a></span></li><li class="c5 c9"><span>Matt Brunt </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/Brunty/status/826755797933756416&amp;sa=D&amp;ust=1485980275124000&amp;usg=AFQjCNGZAa9W05lwUe5lLkuDa_OEQejYNQ">https://twitter.com/Brunty/status/826755797933756416</a></span></li><li class="c5 c9"><span>Isham Mohamed </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/Isham_M_Iqbal/status/826755614013485056&amp;sa=D&amp;ust=1485980275125000&amp;usg=AFQjCNE1EMrQSC-uMptCwkes6SG8G6WFLw">https://twitter.com/Isham_M_Iqbal/status/826755614013485056</a></span></li><li class="c5 c9"><span>Adriå Galin </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/adriagalin/status/826754540955377665&amp;sa=D&amp;ust=1485980275126000&amp;usg=AFQjCNFltmWTiNjmBQ_A9R0fOWv347sxKA">https://twitter.com/adriagalin/status/826754540955377665</a></span></li><li class="c5 c9"><span>Jonathan Burke </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/imprecision/status/826749556566134784&amp;sa=D&amp;ust=1485980275127000&amp;usg=AFQjCNEWHaen4F96xl2q58aIM32FcDocag">https://twitter.com/imprecision/status/826749556566134784</a></span></li><li class="c5 c9"><span>Christo </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/xho/status/826748578240544768&amp;sa=D&amp;ust=1485980275128000&amp;usg=AFQjCNE79nuotbSBWiaHuCbYIcTO406sHg">https://twitter.com/xho/status/826748578240544768</a></span></li><li class="c5 c9"><span>Linux Australia </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/linuxaustralia/status/826741475731976192&amp;sa=D&amp;ust=1485980275129000&amp;usg=AFQjCNGaDvEH_At_6YY57peQbwX3IILUMA">https://twitter.com/linuxaustralia/status/826741475731976192</a></span></li><li class="c5 c9"><span>Emma Jane </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/emmajanehw/status/826737286725455872&amp;sa=D&amp;ust=1485980275131000&amp;usg=AFQjCNGXKKAtHoJQhouUgEmas-5mSSCylw">https://twitter.com/emmajanehw/status/826737286725455872</a></span></li><li class="c5 c9"><span>Rafael Dohms </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/rdohms/status/826719718539194368&amp;sa=D&amp;ust=1485980275132000&amp;usg=AFQjCNFCeKXswDgFFk0oY3lzaNAi3zOq4w">https://twitter.com/rdohms/status/826719718539194368</a></span></li><li class="c5 c9"><span>Mike San Romån </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/msanromanv/status/826710492169269248&amp;sa=D&amp;ust=1485980275133000&amp;usg=AFQjCNEr1BIyvnYKbr9kRts7cRAkSElrow">https://twitter.com/msanromanv/status/826710492169269248</a></span></li><li class="c5 c9"><span>Jono Walker </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/WalkerJono/status/826705353265983488&amp;sa=D&amp;ust=1485980275135000&amp;usg=AFQjCNGzpUFP61iOAbyL3wCFvKs-01i0Xg">https://twitter.com/WalkerJono/status/826705353265983488</a></span></li><li class="c5 c9"><span>Tom Penrose </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/TomPenrose/status/826704616402333697&amp;sa=D&amp;ust=1485980275136000&amp;usg=AFQjCNEVIUySC1r5UoYdEuvQNRojP2EEgg">https://twitter.com/TomPenrose/status/826704616402333697</a></span></li><li class="c5 c9"><span>Jon Wincus </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/jonwincus/status/826683164676521985&amp;sa=D&amp;ust=1485980275137000&amp;usg=AFQjCNHQtBmmuVYpPiVV2u_UpqJ1EaEuMQ">https://twitter.com/jonwincus/status/826683164676521985</a></span></li><li class="c5 c9"><span>Bill Weiss </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/BillWeiss/status/826673719460274176&amp;sa=D&amp;ust=1485980275139000&amp;usg=AFQjCNGj_2KpNrKInxj2UoEOzuIpmIn05w">https://twitter.com/BillWeiss/status/826673719460274176</a></span></li><li class="c5 c9"><span>Alberto Grespan </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/albertogg/status/826662465400340481&amp;sa=D&amp;ust=1485980275140000&amp;usg=AFQjCNEn9_mizJd6YSYN8MwU2VFP64oMgg">https://twitter.com/albertogg/status/826662465400340481</a></span></li><li class="c5 c9"><span>Wicket </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/matthewtrask/status/826650119042957312&amp;sa=D&amp;ust=1485980275141000&amp;usg=AFQjCNFyJMNo4dml-lVSjjiBB0XQ61jL-A">https://twitter.com/matthewtrask/status/826650119042957312</a></span></li><li class="c5 c9"><span>Jesse Dearing </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/JesseDearing/status/826647439587188736&amp;sa=D&amp;ust=1485980275142000&amp;usg=AFQjCNE9o6Va7KbIBC3B0O--Qw04x8WXmQ">https://twitter.com/JesseDearing/status/826647439587188736</a></span></li><li class="c5 c9"><span>Franco Gilio </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/fgili0/status/826642668994326528&amp;sa=D&amp;ust=1485980275144000&amp;usg=AFQjCNH-4XaIwH1-3hsCNOuj8cL-3TBEZw">https://twitter.com/fgili0/status/826642668994326528</a></span></li><li class="c5 c9"><span>Adam DeConinck </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/ajdecon/status/826633522735505408&amp;sa=D&amp;ust=1485980275145000&amp;usg=AFQjCNGfI_sEDrJaTUM0JCkXgbyVDyGgJg">https://twitter.com/ajdecon/status/826633522735505408</a></span></li><li class="c5 c9"><span>Luciano Facchinelli </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/sys0wned/status/826628970150035456&amp;sa=D&amp;ust=1485980275146000&amp;usg=AFQjCNE1SltJ2OiI_L2yaRY-SoF-Jzc1HQ">https://twitter.com/sys0wned/status/826628970150035456</a></span></li><li class="c5 c9"><span>Miguel Di Ciurcio F. </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/mciurcio/status/826628765820321792&amp;sa=D&amp;ust=1485980275148000&amp;usg=AFQjCNEQ513SnEt-u6-9Mj-Xky4ixi9w7Q">https://twitter.com/mciurcio/status/826628765820321792</a></span></li><li class="c5 c9"><span>ceej </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/ceejbot/status/826617667884769280&amp;sa=D&amp;ust=1485980275149000&amp;usg=AFQjCNHObCF7DrhdCw1To9n8CHtBxvZ7Hg">https://twitter.com/ceejbot/status/826617667884769280</a></span></li></ul><h3 class="c19" id="h.k95cblaqd8p1"><span class="c16">Stephen Frost</span></h3><p class="c5"><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://twitter.com/net_snow/status/826622954964393984&amp;sa=D&amp;ust=1485980275151000&amp;usg=AFQjCNEeN5RtQt9GntGF82nyLk9dAUJdtA">https://twitter.com/net_snow/status/826622954964393984</a></span><span class="c3">&nbsp;@gitlabstatus hey, I'm a PG committer, major contributor, and love what you all do. HMU if I can help in any way, I'd be happy to help.</span></p><h3 class="c19" id="h.tdixc7hmw3tc"><span>Sam McLeod</span></h3><p class="c5"><span>Hey Sid, Sorry to hear about your database / LVM issue, bugger of a thing to happen. Hey we run quite a number of PostgreSQL clusters (master/slave) and I noticed a few things in your report. 1. You're using Slony - that thing is a flaming piece of shit, not an understatement even have a laugh at it by following </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=http://howfuckedismydatabase.com&amp;sa=D&amp;ust=1485980275153000&amp;usg=AFQjCNH5HxfuQCZGLF7ONCB_Nh-p6tLw7w">http://howfuckedismydatabase.com</a></span><span class="c3">&nbsp;, PostgreSQL's inbuilt binary streaming replication however is rock solid and very fast, I suggest switching to that. 2. No mention of a connection pooler and mention of having thousands of connections set in postgresql.conf - this is really bad and very inefficient for performance, I suggest using pg_bouncer as a connection pooler - https://pgbouncer.github.io/ &nbsp;and not setting PostgreSQL's max_connection over 512-1024, realistically if you're using more than 256 active connections - you need to scale out not up. 3. The report mentions how fragile your failover and backup processes are, we wrote a simple script for postgresql failover and documentation to go with it - would you like me to provide you with it? As far as backups - we use pgbarman to perform many incremental backups during the day and fill backups twice daily bother via barman and postgresql's pg_dump command, it's important to have your backup directory on different storage from your postgresql data for both performance and resiliancy / portability. 4. You're still on Azure?!?! I'd suggest getting off that crudbucket, so many internal DNS, NTP, routing and storage IO issues with Microsoft's platform it's ridiculous, I've heard some horror stories of how its held together internally too.</span></p><p class="c5"><span class="c3">Let me know if you'd like any more advice on tuning PostgreSQL, I've had a lot of experience with it.</span></p><p class="c5"><span class="c3">&nbsp;Capt. McLeod</span></p><p class="c5"><span class="c3">&nbsp;also - question - how big is your database(s) on disk? like are we talking TB here or still in the GB?</span></p><p class="c5"><span class="c3">7h 7 hours ago</span></p><p class="c5"><span class="c3">&nbsp;Capt. McLeod</span></p><p class="c5"><span class="c3">&nbsp;open sourced my failover / replication sync script:</span></p><p class="c5"><span class="c3">7h 7 hours ago</span></p><p class="c5"><span class="c3">Also - I see you're looking at pgpool - I would not suggest that, look at pgbouncer instead</span></p><p class="c5"><span class="c3">&nbsp;Capt. McLeod</span></p><p class="c5"><span class="c3">&nbsp;Pgpool has lots of problems, we tested it thoroughly and then binned it</span></p><p class="c5"><span class="c3">5h 5 hours ago</span></p><p class="c5"><span class="c3">&nbsp;Capt. McLeod</span></p><p class="c5"><span class="c3">&nbsp;Also, let me know if there's anything I can say publicly on twitter or whatever to support GitLab and your transparency through this event, I know how shit these things are, we had SAN level split brain at infoxchange when I first started and I was so nervous I was vomiting!</span></p><p class="c5"><span class="c3">4h 4 hours ago</span></p><p class="c5"><span class="c3">&nbsp;Sid Sijbrandij</span></p><p class="c5"><span class="c3">&nbsp;Hi Sam, thanks for all the help. Mind if I paste it in a public document to share with the rest of the team?</span></p><p class="c5"><span class="c3">3m 3 minutes ago</span></p><p class="c5"><span class="c3">&nbsp;Capt. McLeod</span></p><p class="c5"><span class="c3">&nbsp;The failover script?</span></p><p class="c5"><span class="c3">3m 2 minutes ago</span></p><p class="c5"><span class="c3">&nbsp;Sid Sijbrandij</span></p><p class="c5"><span class="c3">&nbsp;Everything you messaged.</span></p><p class="c5"><span class="c3">2m 1 minute ago</span></p><p class="c5"><span class="c3">Sure, it's a public repo anyway, but yeah I'm not saying it's perfect - far from but it does work really reliable, I fail between hosts all the time without issue, but YMMV etc etc</span></p><p class="c5"><span class="c3">Yeah absolute re: other recommendations too</span></p><p class="c5"><span class="c3">If you can send me information about your VM that has PostgreSQL on it and your PostgreSQL.conf file I can make comments on any changes / concerns and explain each one</span></p><p class="c5 c17"><span class="c3"></span></p><p class="c5"><span class="c10">Notes regarding the above</span><span class="c3">: </span></p><p class="c5 c17"><span class="c3"></span></p><ul class="c6 lst-kix_9ffndsr7zdrj-0 start"><li class="c5 c9"><span class="c3">Slony was only used for upgrading from 9.2 to 9.6, we use streaming replication for our regular replication needs. </span></li><li class="c5 c9"><span class="c3">Rails already pools/re-uses connections, with 25 connections per process. With 20-ish processes for 20 hosts this produces 10 000 max connections, though there will only be 400-ish active concurrently (as Unicorn is single threaded)</span></li><li class="c5 c9"><span>For load balancing, pooling, better failover, etc, we’re looking into pgpool + streaming replication, with synchronous commits (for data consistency). Pgbouncer does not do load balancing (at least out of the box) as far as we’re aware, only connection pooling. </span><span class="c1"><a class="c4" href="https://www.google.com/url?q=https://github.com/awslabs/pgbouncer-rr-patch&amp;sa=D&amp;ust=1485980275170000&amp;usg=AFQjCNF7UQIB0i8zueX5LUMw_mdPVX_2-A">https://github.com/awslabs/pgbouncer-rr-patch</a></span><span class="c3">&nbsp;might also be an option.</span></li></ul><p class="c5 c17"><span class="c3"></span></p><div><p class="c5 c17"><span class="c3"></span></p></div></div><div id="footer"><span>Published by <a target="_blank" title="Learn more about Google Drive" href="https://docs.google.com/">Google Drive</a></span><span class="dash">–</span><a href="https://docs.google.com/abuse?id=1GCK53YDcBWQveod9kfzW-VCxIABGiryG7_z_6jHdVik">Report Abuse</a><span class="dash">–</span><span>Updated automatically every 5 minutes</span></div><script type="text/javascript">(function(){if(window.jstiming){window.jstiming.a={};window.jstiming.b=1;var f=function(b,a,d){var c=b.t[a],e=b.t.start;if(c&&(e||d))return c=b.t[a][0],void 0!=d?e=d:e=e[0],Math.round(c-e)},m=function(b,a,d){var c="";window.jstiming.srt&&(c+="&srt="+window.jstiming.srt,delete window.jstiming.srt);window.jstiming.pt&&(c+="&tbsrt="+window.jstiming.pt,delete window.jstiming.pt);try{window.external&&window.external.tran?c+="&tran="+window.external.tran:window.gtbExternal&&window.gtbExternal.tran?c+="&tran="+window.gtbExternal.tran():
window.chrome&&window.chrome.csi&&(c+="&tran="+window.chrome.csi().tran)}catch(t){}var e=window.chrome;if(e&&(e=e.loadTimes)){e().wasFetchedViaSpdy&&(c+="&p=s");if(e().wasNpnNegotiated){var c=c+"&npn=1",g=e().npnNegotiatedProtocol;g&&(c+="&npnv="+(encodeURIComponent||escape)(g))}e().wasAlternateProtocolAvailable&&(c+="&apa=1")}var k=b.t,r=k.start,e=[],g=[],h;for(h in k)if("start"!=h&&0!=h.indexOf("_")){var l=k[h][1];l?k[l]&&g.push(h+"."+f(b,h,k[l][0])):r&&e.push(h+"."+f(b,h))}delete k.start;if(a)for(var n in a)c+=
"&"+n+"="+a[n];(a=d)||(a="https:"==document.location.protocol?"https://csi.gstatic.com/csi":"http://csi.gstatic.com/csi");return[a,"?v=3","&s="+(window.jstiming.sn||"_s")+"&action=",b.name,g.length?"&it="+g.join(","):"",c,"&rt=",e.join(",")].join("")};window.jstiming.getReportUri=m;var p=function(b,a,d){b=m(b,a,d);if(!b)return"";a=new Image;var c=window.jstiming.b++;window.jstiming.a[c]=a;a.onload=a.onerror=function(){window.jstiming&&delete window.jstiming.a[c]};a.src=b;a=null;return b};window.jstiming.report=
function(b,a,d){if("prerender"==document.webkitVisibilityState){var c=!1,e=function(){if(!c){a?a.prerender="1":a={prerender:"1"};var g;"prerender"==document.webkitVisibilityState?g=!1:(p(b,a,d),g=!0);g&&(c=!0,document.removeEventListener("webkitvisibilitychange",e,!1))}};document.addEventListener("webkitvisibilitychange",e,!1);return""}return p(b,a,d)};window.jstiming.reportDone=function(b){if(window.jstiming.b<=(b||1))return!1;for(var a in window.jstiming.a)return!1;return!0};var q=function(b,a,
d,c){return 0<d?(c?b.tick(a,c,d):b.tick(a,"",d),!0):!1};window.jstiming.getNavTiming=function(b){if(window.performance&&window.performance.timing){var a=window.performance.timing;q(b,"_dns",a.domainLookupStart)&&q(b,"dns_",a.domainLookupEnd,"_dns");q(b,"_con",a.connectStart)&&q(b,"con_",a.connectEnd,"_con");q(b,"_req",a.requestStart)&&q(b,"req_",a.responseStart,"_req");q(b,"_rcv",a.responseStart)&&q(b,"rcv_",a.responseEnd,"_rcv");if(q(b,"_ns",a.navigationStart)){q(b,"ntsrt_",a.responseStart,"_ns");
q(b,"nsfs_",a.fetchStart,"_ns");var d=!1;try{d=window.external&&window.external.startE}catch(c){}!d&&window.chrome&&window.chrome.csi&&(d=Math.floor(window.chrome.csi().startE));d&&(q(b,"_se",d),q(b,"sens_",a.navigationStart,"_se"));q(b,"ntplt0_",a.loadEventStart,"_ns");q(b,"ntplt1_",a.loadEventEnd,"_ns")}}}};}).call(this);
</script><script type="text/javascript">KX_timer.tick('tl'); if (document.location.protocol == 'https:') {window.jstiming.report(KX_timer, undefined , 'https://gg.google.com/csi');} else {window.jstiming.report(KX_timer);}</script><script type="text/javascript">(function(){var h=this;
function l(a){var c=typeof a;if("object"==c)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return c;var b=Object.prototype.toString.call(a);if("[object Window]"==b)return"object";if("[object Array]"==b||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==b||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";else if("function"==
c&&"undefined"==typeof a.call)return"object";return c}function aa(a,c){var b=Array.prototype.slice.call(arguments,1);return function(){var c=b.slice();c.push.apply(c,arguments);return a.apply(this,c)}}function m(a,c){function b(){}b.prototype=c.prototype;a.o=c.prototype;a.prototype=new b;a.prototype.constructor=a;a.v=function(a,b,f){for(var d=Array(arguments.length-2),e=2;e<arguments.length;e++)d[e-2]=arguments[e];return c.prototype[b].apply(a,d)}};function n(){this.b=this.b;this.a=this.a}n.prototype.b=!1;n.prototype.j=function(){this.b||(this.b=!0,this.g())};n.prototype.g=function(){if(this.a)for(;this.a.length;)this.a.shift()()};function ba(a){a&&"function"==typeof a.j&&a.j()};var p=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},ca=/&/g,da=/</g,ea=/>/g,fa=/"/g,ga=/'/g,ha=/\x00/g,ia=/[\x00&<>"']/;function q(a,c){return a<c?-1:a>c?1:0};var ja=Array.prototype.indexOf?function(a,c,b){return Array.prototype.indexOf.call(a,c,b)}:function(a,c,b){b=null==b?0:0>b?Math.max(0,a.length+b):b;if("string"==typeof a)return"string"==typeof c&&1==c.length?a.indexOf(c,b):-1;for(;b<a.length;b++)if(b in a&&a[b]===c)return b;return-1};function ka(a,c,b){for(var d in a)c.call(b,a[d],d,a)};var t;a:{var u=h.navigator;if(u){var v=u.userAgent;if(v){t=v;break a}}t=""}function w(a){return-1!=t.indexOf(a)};function x(){this.a="";this.b=y}x.prototype.m=!0;x.prototype.l=function(){return this.a};function z(a){return a instanceof x&&a.constructor===x&&a.b===y?a.a:"type_error:SafeUrl"}var la=/^(?:(?:https?|mailto|ftp):|[^&:/?#]*(?:[/?#]|$))/i;function A(a){if(a instanceof x)return a;a=a.m?a.l():String(a);la.test(a)||(a="about:invalid#zClosurez");return ma(a)}var y={};function ma(a){var c=new x;c.a=a;return c}ma("about:blank");function B(){this.a="";this.b=na}B.prototype.m=!0;B.prototype.l=function(){return this.a};var na={};function C(a){var c=new B;c.a=a;return c}C("<!DOCTYPE html>");C("");C("<br>");function D(a){D[" "](a);return a}D[" "]=function(){};function oa(a,c){var b=pa;return Object.prototype.hasOwnProperty.call(b,a)?b[a]:b[a]=c(a)};var qa=w("Opera"),F=w("Trident")||w("MSIE"),ra=w("Edge"),sa=ra||F,G=w("Gecko")&&!(-1!=t.toLowerCase().indexOf("webkit")&&!w("Edge"))&&!(w("Trident")||w("MSIE"))&&!w("Edge"),H=-1!=t.toLowerCase().indexOf("webkit")&&!w("Edge"),ta=w("Macintosh");function ua(){var a=h.document;return a?a.documentMode:void 0}var I;
a:{var J="",K=function(){var a=t;if(G)return/rv\:([^\);]+)(\)|;)/.exec(a);if(ra)return/Edge\/([\d\.]+)/.exec(a);if(F)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(H)return/WebKit\/(\S+)/.exec(a);if(qa)return/(?:Version)[ \/]?(\S+)/.exec(a)}();K&&(J=K?K[1]:"");if(F){var L=ua();if(null!=L&&L>parseFloat(J)){I=String(L);break a}}I=J}var va=I,pa={};
function M(a){return oa(a,function(){for(var c=0,b=p(String(va)).split("."),d=p(String(a)).split("."),e=Math.max(b.length,d.length),f=0;0==c&&f<e;f++){var g=b[f]||"",k=d[f]||"";do{g=/(\d*)(\D*)(.*)/.exec(g)||["","","",""];k=/(\d*)(\D*)(.*)/.exec(k)||["","","",""];if(0==g[0].length&&0==k[0].length)break;c=q(0==g[1].length?0:parseInt(g[1],10),0==k[1].length?0:parseInt(k[1],10))||q(0==g[2].length,0==k[2].length)||q(g[2],k[2]);g=g[3];k=k[3]}while(0==c)}return 0<=c})}var N;var wa=h.document;
N=wa&&F?ua()||("CSS1Compat"==wa.compatMode?parseInt(va,10):5):void 0;!G&&!F||F&&9<=Number(N)||G&&M("1.9.1");F&&M("9");var xa=!F||9<=Number(N),ya=!F||9<=Number(N),za=F&&!M("9");!H||M("528");G&&M("1.9b")||F&&M("8")||qa&&M("9.5")||H&&M("528");G&&!M("8")||F&&M("9");function O(a,c){this.type=a;this.a=this.target=c;this.f=!1}O.prototype.c=function(){this.f=!0};function P(a,c){O.call(this,a?a.type:"");this.a=this.target=null;this.g=!1;this.b=null;if(a){this.type=a.type;this.target=a.target||a.srcElement;this.a=c;if((c=a.relatedTarget)&&G)try{D(c.nodeName)}catch(b){}this.g=a.ctrlKey;this.b=a;a.defaultPrevented&&this.c()}}m(P,O);var Aa=[1,4,2];P.prototype.c=function(){P.o.c.call(this);var a=this.b;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,za)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(c){}};var Ba="closure_listenable_"+(1E6*Math.random()|0),Ca=0;function Da(a,c,b,d,e){this.listener=a;this.a=null;this.src=c;this.type=b;this.capture=!!d;this.b=e;this.s=++Ca;this.h=this.i=!1}function Ea(a){a.h=!0;a.listener=null;a.a=null;a.src=null;a.b=null};function Fa(a){this.src=a;this.a={};this.b=0};var Q="closure_lm_"+(1E6*Math.random()|0),R={},Ga=0;
function Ha(a,c,b,d,e){if("array"==l(c)){for(var f=0;f<c.length;f++)Ha(a,c[f],b,d,e);return null}b=Ia(b);if(a&&a[Ba])a=Ja(a,c,b,d,e);else{f=b;if(!c)throw Error("Invalid event type");b=!!d;var g=T(a);g||(a[Q]=g=new Fa(a));var k=g,S=c.toString(),g=k.a[S];g||(g=k.a[S]=[],k.b++);var r;b:{for(r=0;r<g.length;++r){var E=g[r];if(!E.h&&E.listener==f&&E.capture==!!d&&E.b==e)break b}r=-1}-1<r?(d=g[r],d.i=!1):(d=new Da(f,k.src,S,!!d,e),d.i=!1,g.push(d));if(!d.a){e=Ka();d.a=e;e.src=a;e.listener=d;if(a.addEventListener)a.addEventListener(c.toString(),
e,b);else if(a.attachEvent)a.attachEvent(La(c.toString()),e);else throw Error("addEventListener and attachEvent are unavailable.");Ga++}a=d}return a}function Ka(){var a=Ma,c=ya?function(b){return a.call(c.src,c.listener,b)}:function(b){b=a.call(c.src,c.listener,b);if(!b)return b};return c}
function Na(a){if("number"!=typeof a&&a&&!a.h){var c=a.src;if(c&&c[Ba])c.a(a);else{var b=a.type,d=a.a;c.removeEventListener?c.removeEventListener(b,d,a.capture):c.detachEvent&&c.detachEvent(La(b),d);Ga--;if(b=T(c)){var d=a.type,e;if(e=d in b.a){e=b.a[d];var f=ja(e,a),g;(g=0<=f)&&Array.prototype.splice.call(e,f,1);e=g}e&&(Ea(a),0==b.a[d].length&&(delete b.a[d],b.b--));0==b.b&&(b.src=null,c[Q]=null)}else Ea(a)}}}function La(a){return a in R?R[a]:R[a]="on"+a}
function Oa(a,c,b,d){var e=!0;if(a=T(a))if(c=a.a[c.toString()])for(c=c.concat(),a=0;a<c.length;a++){var f=c[a];f&&f.capture==b&&!f.h&&(f=Pa(f,d),e=e&&!1!==f)}return e}function Pa(a,c){var b=a.listener,d=a.b||a.src;a.i&&Na(a);return b.call(d,c)}
function Ma(a,c){if(a.h)return!0;if(!ya){if(!c)a:{c=["window","event"];for(var b=h,d;d=c.shift();)if(null!=b[d])b=b[d];else{c=null;break a}c=b}d=c;c=new P(d,this);b=!0;if(!(0>d.keyCode||void 0!=d.returnValue)){a:{var e=!1;if(0==d.keyCode)try{d.keyCode=-1;break a}catch(g){e=!0}if(e||void 0==d.returnValue)d.returnValue=!0}d=[];for(e=c.a;e;e=e.parentNode)d.push(e);a=a.type;for(e=d.length-1;0<=e;e--){c.a=d[e];var f=Oa(d[e],a,!0,c),b=b&&f}for(e=0;e<d.length;e++)c.a=d[e],f=Oa(d[e],a,!1,c),b=b&&f}return b}return Pa(a,
new P(c,this))}function T(a){a=a[Q];return a instanceof Fa?a:null}var U="__closure_events_fn_"+(1E9*Math.random()>>>0);function Ia(a){if("function"==l(a))return a;a[U]||(a[U]=function(c){return a.handleEvent(c)});return a[U]};function V(a){n.call(this);this.f=a;this.c={}}m(V,n);var Qa=[];function Ja(a,c,b,d,e){"array"!=l(b)&&(b&&(Qa[0]=b.toString()),b=Qa);for(var f=0;f<b.length;f++){var g=Ha(c,b[f],d||a.handleEvent,e||!1,a.f||a);if(!g)break;a.c[g.s]=g}return a}function Ra(a){ka(a.c,function(a,b){this.c.hasOwnProperty(b)&&Na(a)},a);a.c={}}V.prototype.g=function(){V.o.g.call(this);Ra(this)};V.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented");};var Sa=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ta(a){return a?decodeURI(a):a}var Ua=/#|$/;
function Va(a,c){var b=a.search(Ua),d;a:{d=0;for(var e=c.length;0<=(d=a.indexOf(c,d))&&d<b;){var f=a.charCodeAt(d-1);if(38==f||63==f)if(f=a.charCodeAt(d+e),!f||61==f||38==f||35==f)break a;d+=e+1}d=-1}if(0>d)return null;e=a.indexOf("&",d);if(0>e||e>b)e=b;d+=c.length+1;return decodeURIComponent(a.substr(d,e-d).replace(/\+/g," "))};function W(a){n.call(this);this.c=a||document.body;this.f=new V(this);a=aa(ba,this.f);this.b?a():(this.a||(this.a=[]),this.a.push(a));Ja(this.f,this.c,"click",this.u,void 0)}m(W,n);
W.prototype.u=function(a){if((xa?0==a.b.button:"click"==a.type||a.b.button&Aa[0])&&!(H&&ta&&a.g)&&!a.f)for(var c=a.target;c&&c!=this.c;){if(c.tagName&&"a"==c.tagName.toLowerCase()){var b=c.getAttribute("href")||c.getAttributeNS("http://www.w3.org/1999/xlink","href"),d,e=d=b;try{"www.google.com"==Ta(d.match(Sa)[3]||null)&&"/url"==Ta(d.match(Sa)[5]||null)&&(e=Va(d,"q")||Va(d,"url"))}catch(k){}d=e?e:"";if(b!=d){var f=void 0,e=d;d={target:"_blank",noreferrer:!0};var c=window,b=e instanceof x?e:A("undefined"!=
typeof e.href?e.href:String(e)),e=d.target||e.target,g=[];for(f in d)switch(f){case "width":case "height":case "top":case "left":g.push(f+"="+d[f]);break;case "target":case "noreferrer":break;default:g.push(f+"="+(d[f]?1:0))}f=g.join(",");(w("iPhone")&&!w("iPod")&&!w("iPad")||w("iPad")||w("iPod"))&&c.navigator&&c.navigator.standalone&&e&&"_self"!=e?(g=f=c.document.createElement("A"),b=b instanceof x?b:A(b),g.href=z(b),f.setAttribute("target",e),d.noreferrer&&f.setAttribute("rel","noreferrer"),b=document.createEvent("MouseEvent"),
b.initMouseEvent("click",!0,!0,c,1),f.dispatchEvent(b)):d.noreferrer?(c=c.open("",e,f),b=z(b),c&&(sa&&-1!=b.indexOf(";")&&(b="'"+b.replace(/'/g,"%27")+"'"),c.opener=null,ia.test(b)&&(-1!=b.indexOf("&")&&(b=b.replace(ca,"&amp;")),-1!=b.indexOf("<")&&(b=b.replace(da,"&lt;")),-1!=b.indexOf(">")&&(b=b.replace(ea,"&gt;")),-1!=b.indexOf('"')&&(b=b.replace(fa,"&quot;")),-1!=b.indexOf("'")&&(b=b.replace(ga,"&#39;")),-1!=b.indexOf("\x00")&&(b=b.replace(ha,"&#0;"))),b=C('<META HTTP-EQUIV="refresh" content="0; url='+
b+'">'),c.document.write(b instanceof B&&b.constructor===B&&b.b===na?b.a:"type_error:SafeHtml"),c.document.close())):c.open(z(b),e,f);a.c();break}}c=c.parentNode}};function Wa(a){new W(a)}var X=["DOCS_installLinkReferrerSanitizer"],Y=h;X[0]in Y||!Y.execScript||Y.execScript("var "+X[0]);for(var Z;X.length&&(Z=X.shift());)X.length||void 0===Wa?Y[Z]&&Object.prototype.hasOwnProperty.call(Y,Z)?Y=Y[Z]:Y=Y[Z]={}:Y[Z]=Wa;}).call(this);
</script><script type="text/javascript">DOCS_installLinkReferrerSanitizer();</script></body><div></div></html>